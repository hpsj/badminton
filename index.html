<!DOCTYPE html>
<html>

<head>
    <title>ç¾½æ¯›çƒç§¯åˆ†ç³»ç»Ÿ</title>
    <style>
        body {
            background-color: #e6f3ff;
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            flex-direction: column;
            min-height: 100vh;
        }

        .title {
            text-align: center;
            color: #333;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .menu {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: white;
            transition: transform 0.2s;
        }

        button:hover {
            transform: scale(1.05);
        }

        .content-container {
            display: flex;
            flex: 1;
            gap: 20px;
        }

        .gridx {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            max-width: 1200px;
            margin: 0 auto;
            flex: 1;
        }

        .student-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
            position: relative;
            flex-basis: calc(20.5% - 20px); /* è°ƒæ•´å¡ç‰‡å®½åº¦ï¼Œå®ç°å¹¶åˆ—å±•ç¤º8å¼  */
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 10px;
            border: 2px solid #ddd;
        }

        .student-name {
            font-size: 20px;
            color: #333;
            margin-bottom: 15px;
        }

        .score {
            font-size: 24px;
            color: #ff4444;
            margin: 15px 0;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .controls {
            display: flex;
            justify-content: space-between;
        }

        .btn-control {
            font-size: 24px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-minus {
            background-color: #ff6666;
            color: white;
        }

        .btn-plus {
            background-color: #66cc66;
            color: white;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        /* æ’è¡Œæ¦œè¾¹æ æ ·å¼ */
        .sidebar {
            width: 600px; /* å¢å¤§æ’è¡Œæ¦œå¼¹çª—å®½åº¦ */
            right: 0;
            top: 0;
            background: white;
            border-radius: 10px;
            padding: 20px;
            height: 100vh;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            overflow-y: auto;
            position: fixed;
            transform: translateX(100%);
        }

        .sidebar.collapsed {
            transform: translateX(0);
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .sidebar-title {
            font-size: 1.5em;
            color: #333;
        }

        .toggle-sidebar {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            background: #f5f5f5;
        }

        .ranking-item:hover {
            background: #e9e9e9;
        }

        .rank {
            font-weight: bold;
            width: 30px;
            text-align: center;
        }

        .ranking-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 10px;
        }

        .ranking-name {
            flex: 1;
            text-align: left;
        }

        .ranking-score {
            color: #ff4444;
            font-weight: bold;
        }

        .medal {
            margin-right: 5px;
        }

        /* æ·»åŠ å­¦ç”Ÿå¤´åƒä¸Šä¼ æ ·å¼ */
        .avatar-upload {
            display: none;
        }

        .avatar-container {
            position: relative;
            margin: 0 auto 10px;
            width: 80px;
        }

        .change-avatar {
            position: absolute;
            bottom: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            cursor: pointer;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .score-input {
            width: 100px;
            padding: 5px;
            border: 2px solid #ff4444;
            border-radius: 5px;
            text-align: center;
            font-size: 24px;
            color: #333;
        }

        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #ff6666;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
        }

        /* ç§¯åˆ†è®°å½•å¼¹çª—æ ·å¼ */
        .record-modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .record-modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 10px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .record-list {
            list-style-type: none;
            padding: 0;
        }

        .record-list li {
            margin-bottom: 10px;
        }

        /* æŠ€æœ¯è¯„ä»·æ ·å¼ */
        .skill-rating {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }

        .skill-rating label {
            display: block;
            margin-bottom: 5px;
        }

        .skill-rating .stars {
            color: #ffc107;
            cursor: pointer;
        }

        .skill-rating .stars i {
            margin-right: 2px;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
<h1 class="title">ğŸ¸ å¹¿é™„å®å°ç¾½æ¯›çƒæ ¡é˜Ÿç§¯åˆ†ç³»ç»Ÿ ğŸ¸</h1>

<div class="menu">
    <button onclick="adjustAll()">å…¨é˜ŸåŠ åˆ†</button>
    <button onclick="clearAll()">å…¨é˜Ÿæ¸…é›¶</button>
    <button onclick="toggleSidebar()">æ’è¡Œæ¦œ</button>
    <input type="file" id="importFile" style="display: none;" accept=".txt">
    <button onclick="document.getElementById('importFile').click()">å¯¼å…¥ç§¯åˆ†</button>
    <button onclick="exportData()">å¯¼å‡ºç§¯åˆ†</button>
    <button onclick="addStudent()">æ·»åŠ å­¦ç”Ÿ</button>
    <button onclick="showScoreRecords()">ç§¯åˆ†è®°å½•</button>
</div>

<div class="content-container">
    <div class="gridx" id="studentGrid"></div>
</div>
<!-- æ’è¡Œæ¦œè¾¹æ  -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="sidebar-title">ç§¯åˆ†æ’è¡Œæ¦œ</div>
        <button class="toggle-sidebar" onclick="toggleSidebar()">Ã—</button>
    </div>
    <div id="rankingList"></div>
</div>

<!-- ç§¯åˆ†è®°å½•å¼¹çª— -->
<div id="recordModal" class="record-modal">
    <div class="record-modal-content">
        <span class="close">&times;</span>
        <h2>ç§¯åˆ†è®°å½•</h2>
        <ul id="recordList" class="record-list"></ul>
    </div>
</div>

<script>
    let students = [];
    const defaultAvatar = ''
    let scoreRecords = [];
    const skills = ['æŒ‘çƒ', 'æ”¾ç½‘', 'æ¨çƒ', 'æ¥æ€é˜²å®ˆ', 'é«˜è¿œçƒ', 'åŠçƒ', 'æ€çƒ'];

    // åˆå§‹åŒ–å­¦ç”Ÿåå•
    const initialStudents = [
        "æ—æ™¨", "éƒ­å›èˆª", "å±ˆè¯—é¢–", "ç½—ç« é¸£", "æœæ¸…æ¼ª",
        "ç½—æ­£æ¶›", "ä½™é–è£", "å®‹ç¾½æ™¨", "ç½—å…¶ç»…", "è¢çš“è½©",
        "èƒ¡æ¢¦æ¶µ", "è´ºäº‘"
    ];

    // åŠ è½½æœ¬åœ°å­˜å‚¨æ•°æ®
    function loadData() {
        const savedStudents = localStorage.getItem('students');
        if (savedStudents) {
            students = JSON.parse(savedStudents);
            // ç¡®ä¿æœ¬åœ°å­˜å‚¨çš„æ•°æ®åŒ…å«æ‰€æœ‰åˆå§‹å­¦ç”Ÿ
            initialStudents.forEach(studentName => {
                const existingStudent = students.find(student => student.name === studentName);
                if (!existingStudent) {
                    const skillsObj = {};
                    skills.forEach(skill => skillsObj[skill] = 0);
                    students.push({
                        name: studentName,
                        score: 0,
                        avatar: defaultAvatar,
                        skills: skillsObj
                    });
                }
            });
        } else {
            students = initialStudents.map(name => {
                const skillsObj = {};
                skills.forEach(skill => skillsObj[skill] = 0);
                return {
                    name,
                    score: 0,
                    avatar: defaultAvatar,
                    skills: skillsObj
                };
            });
        }
        const savedRecords = localStorage.getItem('scoreRecords');
        scoreRecords = savedRecords ? JSON.parse(savedRecords) : [];
        renderGrid();
        updateRanking();
    }

    // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
    function saveData() {
        localStorage.setItem('students', JSON.stringify(students));
        localStorage.setItem('scoreRecords', JSON.stringify(scoreRecords));
        updateRanking();
    }

    // æ¸²æŸ“å­¦ç”Ÿå¡ç‰‡
    function renderGrid() {
        const grid = document.getElementById('studentGrid');
        grid.innerHTML = '';

        students.forEach((student, index) => {
            const card = document.createElement('div');
            card.className = 'student-card';
            let skillRatingHtml = '';
            skills.forEach(skill => {
                let starsHtml = '';
                for (let i = 1; i <= 5; i++) {
                    starsHtml += `<i class="fa-star ${i <= student.skills[skill] ? 'fas' : 'far'}" onclick="rateSkill(${index}, '${skill}', ${i})"></i>`;
                }
                skillRatingHtml += `<div class="skill-rating"><label>${skill}ï¼š</label><div class="stars">${starsHtml}</div></div>`;
            });
            card.innerHTML = `
                    <button class="delete-btn" onclick="deleteStudent(${index})">Ã—</button>
                    <div class="avatar-container">
                        <img src="${student.avatar || defaultAvatar}" class="avatar" id="avatar-${index}">
                        <div class="change-avatar" onclick="changeAvatar(${index})">+</div>
                        <input type="file" class="avatar-upload" id="avatar-upload-${index}" accept="image/*" onchange="handleAvatarUpload(${index}, this)">
                    </div>
                    <div class="student-name">${student.name}</div>
                    <div class="score" id="score-${index}" onclick="editScore(${index})">${student.score}</div>
                    <div class="controls">
                        <button class="btn-control btn-minus" onclick="changeScore(${index}, -1)">-</button>
                        <button class="btn-control btn-plus" onclick="changeScore(${index}, 1)">+</button>
                    </div>
                    ${skillRatingHtml}
                `;
            grid.appendChild(card);
        });
    }

    // åˆ†æ•°è°ƒæ•´å‡½æ•°ï¼ˆç‚¹å‡»åŠ å‡æŒ‰é’®ï¼‰
    function changeScore(index, delta) {
        const student = students[index];
        const oldScore = student.score;
        student.score += delta;
        saveScoreRecord(student.name, delta, oldScore, student.score);
        saveData();

        // æ·»åŠ åŠ¨ç”»æ•ˆæœ
        const scoreElement = document.getElementById(`score-${index}`);
        scoreElement.style.animation = 'pulse 0.3s';
        setTimeout(() => scoreElement.style.animation = '', 300);

        scoreElement.textContent = student.score;
    }

    // ç‚¹å‡»ç§¯åˆ†ç›´æ¥è¾“å…¥
    function editScore(index) {
        const scoreElement = document.getElementById(`score-${index}`);
        const currentScore = students[index].score;

        // åˆ›å»ºè¾“å…¥æ¡†
        const input = document.createElement('input');
        input.className = 'score-input';
        input.type = 'number';
        input.value = currentScore;
        input.min = 0; // é™åˆ¶æœ€ä½åˆ†0åˆ†ï¼Œå¯æ ¹æ®éœ€æ±‚è°ƒæ•´
        input.style.width = '100px';

        // æ›¿æ¢å…ƒç´ 
        scoreElement.parentNode.replaceChild(input, scoreElement);

        // å¤±å»ç„¦ç‚¹æ—¶ä¿å­˜
        input.addEventListener('blur', function () {
            const newScore = parseInt(this.value) || 0;
            const student = students[index];
            const delta = newScore - student.score;
            if (newScore >= 0) { // ç¡®ä¿åˆ†æ•°ä¸ºéè´Ÿæ•´æ•°
                student.score = newScore;
                saveScoreRecord(student.name, delta, currentScore, newScore);
                saveData();
                renderScoreDisplay(index, newScore);
            } else {
                renderScoreDisplay(index, currentScore); // è¾“å…¥æ— æ•ˆæ—¶æ¢å¤åŸåˆ†æ•°
            }
        });

        // å›è½¦æ—¶ä¿å­˜
        input.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                const newScore = parseInt(this.value) || 0;
                const student = students[index];
                const delta = newScore - student.score;
                if (newScore >= 0) {
                    student.score = newScore;
                    saveScoreRecord(student.name, delta, currentScore, newScore);
                    saveData();
                    renderScoreDisplay(index, newScore);
                } else {
                    renderScoreDisplay(index, currentScore);
                }
            }
        });
    }

    // æ¸²æŸ“åˆ†æ•°æ˜¾ç¤ºï¼ˆè¾…åŠ©å‡½æ•°ï¼‰
    function renderScoreDisplay(index, score) {
        const scoreElement = document.createElement('div');
        scoreElement.className = 'score';
        scoreElement.textContent = score;
        scoreElement.onclick = () => editScore(index); // é‡æ–°ç»‘å®šç‚¹å‡»äº‹ä»¶
        document.getElementById(`studentGrid`).querySelector(`[id="score-${index}"]`).parentNode.replaceChild(scoreElement, document.getElementById(`studentGrid`).querySelector(`[id="score-${index}"]`));
    }

    // å…¨é˜Ÿè°ƒæ•´åˆ†æ•°
    function adjustAll() {
        const input = prompt('è¯·è¾“å…¥è°ƒæ•´åˆ†æ•°ï¼ˆæ­£æ•°åŠ åˆ†ï¼Œè´Ÿæ•°æ‰£åˆ†ï¼‰:');
        const delta = parseInt(input) || 0;

        students.forEach(student => {
            const oldScore = student.score;
            student.score += delta;
            saveScoreRecord(student.name, delta, oldScore, student.score);
        });
        saveData();
        renderGrid();
    }

    // å…¨é˜Ÿæ¸…é›¶
    function clearAll() {
        if (confirm('ç¡®å®šè¦æ¸…é›¶æ‰€æœ‰ç§¯åˆ†å—ï¼Ÿ')) {
            students.forEach(student => {
                const oldScore = student.score;
                const delta = -oldScore;
                student.score = 0;
                saveScoreRecord(student.name, delta, oldScore, 0);
            });
            saveData();
            renderGrid();
        }
    }

    // æ›´æ–°æ’è¡Œæ¦œ
    function updateRanking() {
        const sorted = [...students].sort((a, b) => b.score - a.score);
        const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
        const rankingList = document.getElementById('rankingList');
        rankingList.innerHTML = '';

        sorted.forEach((student, index) => {
            const totalStars = Object.values(student.skills).reduce((sum, stars) => sum + stars, 0);
            const averageStars = totalStars / skills.length;
            let averageStarsHtml = '';
            for (let i = 1; i <= 5; i++) {
                averageStarsHtml += `<i class="fa-star ${i <= averageStars ? 'fas' : 'far'}"></i>`;
            }
            const rankItem = document.createElement('div');
            rankItem.className = 'ranking-item';
            rankItem.innerHTML = `
                    <div class="rank">${index + 1}</div>
                    <div class="medal">${index < 3 ? medals[index] : ''}</div>
                    <img src="${student.avatar || defaultAvatar}" class="ranking-avatar">
                    <div class="ranking-name">${student.name} ${averageStarsHtml}</div>
                    <div class="ranking-score">${student.score}</div>
                `;
            rankingList.appendChild(rankItem);
        });
    }

    // å¯¼å‡ºæ•°æ®
    function exportData() {
        const data = students.map(s => {
            const skillsStr = skills.map(skill => s.skills[skill]).join(',');
            return `${s.name},${s.score},${s.avatar || ''},${skillsStr}`;
        }).join('\n');
        const blob = new Blob([data], {type: 'text/plain'});
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = 'ç§¯åˆ†æ•°æ®.txt';
        a.click();
    }

    // å¯¼å…¥æ•°æ®
    document.getElementById('importFile').addEventListener('change', function (e) {
        const file = e.target.files[0];
        const reader = new FileReader();

        reader.onload = function () {
            const lines = reader.result.split('\n');
            students = lines.filter(line => line.trim()).map(line => {
                const parts = line.split(',');
                const skillsObj = {};
                skills.forEach((skill, i) => skillsObj[skill] = parseInt(parts[i + 3]) || 0);
                return {
                    name: parts[0],
                    score: parseInt(parts[1]) || 0,
                    avatar: parts[2] || defaultAvatar,
                    skills: skillsObj
                };
            });

            saveData();
            renderGrid();
        };

        reader.readAsText(file);
    });

    // æ·»åŠ å­¦ç”Ÿ
    function addStudent() {
        const name = prompt('è¯·è¾“å…¥æ–°å­¦ç”Ÿå§“å:');
        if (name) {
            const skillsObj = {};
            skills.forEach(skill => skillsObj[skill] = 0);
            students.unshift({
                name,
                score: 0,
                avatar: defaultAvatar,
                skills: skillsObj
            });
            saveData();
            renderGrid();
        }
    }

    // åˆ é™¤å­¦ç”Ÿ
    function deleteStudent(index) {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¯¥å­¦ç”Ÿå—ï¼Ÿ')) {
            students.splice(index, 1);
            saveData();
            renderGrid();
        }
    }

    // åˆ‡æ¢è¾¹æ æ˜¾ç¤º/éšè—
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('collapsed');
    }

    // è§¦å‘å¤´åƒä¸Šä¼ 
    function changeAvatar(index) {
        document.getElementById(`avatar-upload-${index}`).click();
    }

    // å¤„ç†å¤´åƒä¸Šä¼ 
    function handleAvatarUpload(index, input) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                students[index].avatar = e.target.result;
                saveData();
                document.getElementById(`avatar-${index}`).src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    // ä¿å­˜ç§¯åˆ†è®°å½•
    function saveScoreRecord(name, delta, oldScore, newScore) {
        const days = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const weekDay = days[now.getDay()];
        const dateStr = `${year}-${month}-${day} ${weekDay}`;
        const record = {
            name,
            delta,
            oldScore,
            newScore,
            date: dateStr
        };
        scoreRecords.push(record);
    }

    // æ˜¾ç¤ºç§¯åˆ†è®°å½•
    function showScoreRecords() {
        const modal = document.getElementById('recordModal');
        const recordList = document.getElementById('recordList');
        recordList.innerHTML = '';

        const groupedRecords = {};
        scoreRecords.forEach(record => {
            const key = `${record.date}-${record.name}`;
            if (!groupedRecords[key]) {
                groupedRecords[key] = {
                    date: record.date,
                    name: record.name,
                    totalDelta: record.delta,
                    finalScore: record.newScore
                };
            } else {
                groupedRecords[key].totalDelta += record.delta;
                groupedRecords[key].finalScore = record.newScore;
            }
        });

        Object.values(groupedRecords).forEach(record => {
            const li = document.createElement('li');
            li.textContent = `${record.date} ${record.name} ç§¯åˆ†å˜åŠ¨ ${record.totalDelta > 0 ? '+' + record.totalDelta : record.totalDelta}ï¼Œç´¯è®¡ç§¯åˆ† ${record.finalScore}`;
            recordList.appendChild(li);
        });

        modal.style.display = 'block';

        const closeBtn = document.querySelector('.close');
        closeBtn.onclick = function () {
            modal.style.display = 'none';
        };

        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        };
    }

    // æŠ€æœ¯è¯„ä»·å‡½æ•°
    function rateSkill(index, skill, rating) {
        students[index].skills[skill] = rating;
        saveData();
        renderGrid();
    }

    // åˆå§‹åŒ–åŠ è½½
    document.addEventListener('DOMContentLoaded', loadData);
</script>

</body>

</html>    